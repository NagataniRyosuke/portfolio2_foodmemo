{% extends 'foodmemoapp/base.html' %}
{% block content %}
{% load static %}
<nav>
    <h1>Food Diary</h1>
    <ul>
        <li><a href="{% url 'top' %}">ホーム</a></li>
        <li><a href="{% url 'create-memo' %}">新しい投稿</a></li>
        <li><a href="{% url 'timeline' %}">タイムライン</a></li>
        <li>{% if request.user.is_authenticated %}
            <form action="{% url 'logout' %}" method="post">
                {% csrf_token %}
                <button type="submit">ログアウト</button>
            </form>
            {% else %}
            <form action="{% url 'login' %}" method="post">
                {% csrf_token %}
                <button type="submit">ログイン</button>
            </form>
            {% endif %}
        </li>
    </ul>
</nav>
<div class="back-img" id="text-to-hide">
    <video autoplay muted loop id="background-video">
        <source src="/static/css/img/backmovie.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    <div class="v-text">
        <h1>食歴。</h1>
    </div>
</div>
<div id="time-line">
    <h1>みんなの投稿</h1>


    {% for memo in memos %}
    <div class="memo-container">
        <div class="line-1">
            <p>日付:{{memo.Date}}</p>
            <p>投稿主:{{ memo.user.username }}</p>
        </div>
        <div class="line-2">
            <p>店舗名:{{ memo.name }}</p>
        </div>
        <div class="line-3">
            <p>感想:{{ memo.description }}</p>
        </div>
        <div class="line-4">
            {% if memo.image %}
            <img src="{{ memo.image.url }}" alt="{{ memo.name }}">
            {% else %}
            <img src="/static/css/img/noimg.png" alt="">
            {% endif %}
        </div>
        <div class="icon">
            <a href="{{ memo.twitter_share_url }}" target="_blank">
                <img src="{% static 'css/img/icon.png' %}" alt="twitter">
            </a>
        </div>
    </div>
    {% endfor %}

</div>
<script>

    window.addEventListener('scroll', function () {
        const textElement = document.getElementById('text-to-hide');
        const scrollPosition = window.scrollY;

        // スクロールが100pxを超えたら文字をフェードアウト
        if (scrollPosition > 250) {
            textElement.style.opacity = '0'; // 透明にする
            textElement.style.transition = 'opacity 0.4s ease'; // フェードアウトのアニメーション
        } else {
            textElement.style.opacity = '1'; // 100px未満なら再表示
        }
    });

    document.addEventListener('DOMContentLoaded', function () {
    const images = document.querySelectorAll('.line-4 img');

    images.forEach(function (img) {
        img.onload = function () {
            const width = img.naturalWidth;
            const height = img.naturalHeight;

            // 画像が縦長であればportraitクラスを追加し、横長であればlandscapeクラスを追加
            const storedOrientation = localStorage.getItem(img.src);
            if (!storedOrientation) {
                if (height > width) {
                    img.classList.add('portrait');
                    localStorage.setItem(img.src, 'portrait');
                } else {
                    img.classList.add('landscape');
                    localStorage.setItem(img.src, 'landscape');
                }
            } else {
                img.classList.add(storedOrientation);
            }
        };

        // もしすでに画像がキャッシュされていた場合でも処理を行う
        if (img.complete) {
            img.onload();  // 画像が既に読み込まれていた場合、onloadを手動で呼び出す
        }
    });
});

</script>
{% endblock %}